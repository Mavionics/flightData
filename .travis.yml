language: android
sudo: required
jdk: oraclejdk8

env:
 global:
 - ANDROID_API=28
 - EMULATOR_API=23
 - ANDROID_BUILD_TOOLS=27.0.3
 - ANDROID_ABI=armeabi-v7a
 - ANDROID_TAG=google_apis
 - ADB_INSTALL_TIMEOUT=10 # minutes
 # storepass
 - secure: "el9Bm05NdeTS18LQX6f9qdaZC+7kRMWl4/xQmt8ZSGZmquE0ytJu1+8bdu1HIZlOdvqvCfNpgVRUvabCmfCPSiPYOgkAz0oE5oc2U+dKX5OaQLMVuN3LgvqoF11fJyft/0rqCfdyVhdE9Mg3SJ7OVKbELUp+S1g5gD0rtlB2D5W5UWWDO4oUiohbsLI09iYHFztsUtDomMiy3JnHF1+GZMSza/veiR2y81nEdoWV5pHZxdq2FKqCJ44MDxXV/kkR7ZaPeGo9qd/FYP9AJEe/qqw86f00qYzNPLGGY9+azX/Eq0adCCH/077J0zuQP+UafYGrNXiV5qJ4xb+0cQKyu8sERFtb6Cw09rYPet1+pxSYdm9ahMRi7TY67hBaO29+p8gZBQhaTwbEwqw8XsqbXekqFzUVP6WTc7YwSQpX7sy/0Fdor43D1GBVkwazZ0JjYrgZFg2aTXqC/ArVDuw0OnhbVC9PdFu078tmvurLb4Y3yvE4FYHYkx53y33EQ+Tnlhs0GVSkLWSbTUgsuUFPZOD8/+paHtG6M+RjRcUIumcg0DsSuvKXNcYiSIuLCcpdJHmpjyjbkYL2ZKUFi0XWceNr+k9TtYgLiKKVYTyJJkpY1/99O5+p8GLcU7QE5YgLGL1AbXCd6ezB2lYCRGYAIWVgjjYZoJLvFLByl7cIeL8="
 # keypass
 - secure: "itWaYBVKCFXa+sEZrIanzgXp14VnA7EgJfv4o2FW7lr7Ya5XgaKJ3unQDYv6t9RsQ4rfh6LAdvJyThH4U0Wy5K5+mOGoijzAAErdGgH0addyJZhqBXCc8Z9bwaR2M+W2IWFZ2xFCVLxdyk8A91D8It4K9YB25XgWx4zYocDRwPx975akqs8jaSwHIu6xGhohziyA3UeuxLfhtdfoOVrVDfCgWyZriOJon4IJ2Wq//leq1QO+mEpA0twbnoxp1mIDDgk3DB8CEYOuFJklHi6/6EcVi6w3qKr23BVW8PNXpY7Y577SkFZ32lzdKeNnSGUOqq7P8jhTxn+ujjVh8ksxq4UuhFwVCvzXjx41cn9FZ2lBme1rA4wYZWW3td1Qy6OTKop8zvIXGfDeyoBAho7YN/JfK/wBkvSW08Nw6IzOTEGC/vu2VWXV1zN5t9oh2gWHOgR8kLjsMp455nFiRG7NyKloOmwp604qTQTXz5N//QmZBoxcYfBmgUcw1BItRaU/dpW9Vmoe7TddpCXaqgcICdn2OMPeSrnWHkbQBimzL+4AEm5jUtHfsz3Ovq+ryuOzGX1GK88mUAIEFXpzxnJSJBeDYR43NddvcZro3pfzyx/NIWhENg6AB1Mh28SrRT0e/mAF++LLnSkjmkASk15EiMBN0j63FvARMJcd+bOmXSM="
addons:
  apt_packages:
    - pandoc

notifications:
  slack:
    secure: RaQO3+UJmOVn0k6fGMrrEWvSsbBY81ogY3izbOzNnX6/Ebm6apsi6juHrRajGRKZA4Qk556jGC3RhVT/+RcCx6DPoIP/YKXvWaQzRT+/nXlrWV+PEQ7feE2niAMoKQxpyZ0QaE6mJ06tXaomLV1orn1I9Z7E1JmyVAfJ4DsFgjrkcrTiHz1wDgjcJ/am2Q4dEDLH/mz3pxX/k25MVPw12WL7HKcdAiJzd+rcQn2duaNlmU1a0xfytrnbAK/op7VWx9qsSasDkzJBTZgwXjlL+Db67Jp2ZcngFYjJax46gSCUnJNVC5z8OczM0bjQTTZC1QryVLicIZhYDj34eRdp0Mhskzbn0jW7AuriMBb8+KhyL6BWTHd8sSPw5WSgr3Ypt+1FPqrZP/6WSeSt9dfUD3PhHPXxgY/zuwfKYUVhs1OS1jWQ/m2d2ZupTjQTfTUggsMCFQBaftYGgLckeOuFmGLFuJ95ZdAytkGiakO46ZBqcp5aLlla6OWmarYv66mBSltxAEN1xb0ViYzsZ866qM2Ucm+0vhLnbxEzR00lP30XKuzAEW+2OHMQtor0h9oMMAgHbViAdPwx7e5avvXMCAeCEH15ZuEJbNpZiJNOVvLcRIyg43zz+41z9VEd6+jkribOIfpnqYW4wqsogw/yCtw8AhxmintBvpi15N04uAo=

android:
  components:
    - tools
    - platform-tools
    - tools
    - build-tools-$ANDROID_BUILD_TOOLS
    - android-$ANDROID_API
    - android-$EMULATOR_API
    - sys-img-armeabi-v7a-google_apis-$ANDROID_API
    - sys-img-armeabi-v7a-google_apis-$EMULATOR_API
    - add-on
    - extra
  licenses:
    - 'android-sdk-preview-license-52d11cd2'
    - 'android-sdk-license-.+'
    - 'google-gdk-license-.+'

before_cache:
 - rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
 - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
 directories:
 - $HOME/.gradle/caches/
 - $HOME/.gradle/wrapper/

before_install:
  - mkdir -p $ANDROID_HOME/licenses
  - echo "8933bad161af4178b1185d1a37fbf41ea5269c55" > $ANDROID_HOME/licenses/android-sdk-license
  - echo "d56f5187479451eabf01fb78af6dfcb131a6481e" >> $ANDROID_HOME/licenses/android-sdk-license
  - touch /home/travis/.android/repositories.cfg
  - openssl aes-256-cbc -K $encrypted_ac356ff71e5e_key -iv $encrypted_ac356ff71e5e_iv -in keystore.jks.enc -out keystore.jks -d
install:
  - echo y | sdkmanager "ndk-bundle"
  - echo y | sdkmanager "cmake;3.6.4111459"
  - echo y | sdkmanager "lldb;3.1"

before_script:
  # Create and start emulator
  #- echo no | android create avd --force -n test -t "android-"$EMULATOR_API --abi $ANDROID_ABI --tag $ANDROID_TAG
  #- emulator -avd test -no-skin -no-audio -no-window &
  #- android-wait-for-emulator
  #- adb shell input keyevent 82 &

script:
  - ./gradlew clean build -PdisablePreDex --continue --stacktrace --profile
  - pandoc `ls -1rt build/reports/profile/profile-*.html | tail -n1` -t plain
